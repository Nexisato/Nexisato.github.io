<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CSAPP Lab (02)-Bomb Lab | CaddiesNew's Blog</title><meta name="author" content="Nexisato"><meta name="copyright" content="Nexisato"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文记录了CSAPP配套实验——Bomb Lab的详情WriteUp    运行环境：  Ubuntu 20.04     任务 拆除&amp;quot;bomb&amp;quot;：通过反汇编，拆除bomb，以达到拆弹的目的。  知识储备  GDB调试器的使用  对于C&amp;#x2F;C++程序的调试，需要在编译前加上-g。"><link rel="shortcut icon" href="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/TopImages/Kaleido.png"><link rel="canonical" href="https://nexisato.github.io/2021/03/26/csapp-bomblab/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?https://hm.baidu.com/hm.js?1c79a70b546e1eccefe56413e83a992a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CSAPP Lab (02)-Bomb Lab',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-07-07 12:59:17'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora-user-images/1.JPG" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/TopImages/CSAPP.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="CaddiesNew's Blog"><span class="site-name">CaddiesNew's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CSAPP Lab (02)-Bomb Lab</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-03-25T16:00:00.000Z" title="发表于 2021-03-26 00:00:00">2021-03-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-07-07T04:59:17.655Z" title="更新于 2022-07-07 12:59:17">2022-07-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">基础知识</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/CSAPP/">CSAPP</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>本文记录了CSAPP配套实验——Bomb Lab的详情WriteUp</p>
</blockquote>
<ul>
<li>
<p>运行环境：</p>
<ul>
<li>Ubuntu 20.04</li>
</ul>
</li>
</ul>
<hr>
<h3 id="任务">任务</h3>
<p>拆除&quot;bomb&quot;：通过反汇编，拆除bomb，以达到拆弹的目的。</p>
<hr>
<h3 id="知识储备">知识储备</h3>
<ul>
<li><strong>GDB调试器的使用</strong></li>
</ul>
<p>对于C/C++程序的调试，需要在编译前加上<code>-g</code>。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$g</span>++ <span class="token parameter variable">-g</span> test.cpp <span class="token parameter variable">-o</span> <span class="token builtin class-name">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>接下来开启<code>gdb</code>调试器调试程序：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$gdb</span> <span class="token builtin class-name">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>启用<code>gdb</code>进入交互模式后，可以用如下命令调试程序</p>
<ul>
<li><strong>运行</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">Instruction</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">r(un)</td>
<td>运行程序，当遇到断点后，程序会在断点处停止运行，等待用户输入下一步的命令</td>
</tr>
<tr>
<td style="text-align:left">c(ontinue)</td>
<td>继续执行，到下一个断点处（或运行结束）</td>
</tr>
<tr>
<td style="text-align:left">n(ext)</td>
<td>单步跟踪程序，当遇到函数调用时，也不进入此函数体</td>
</tr>
<tr>
<td style="text-align:left">s(tep)</td>
<td>单步调试如果有函数调用，则进入函数</td>
</tr>
<tr>
<td style="text-align:left">until( lineNumber)</td>
<td>运行程序直到退出循环体，加行号可以直接运行到某行</td>
</tr>
<tr>
<td style="text-align:left">finish</td>
<td>运行至当前函数完成返回，并打印函数返回时的堆栈地址和返回值及参数值等信息。</td>
</tr>
<tr>
<td style="text-align:left">call function(params)</td>
<td>调用程序中可用函数，并传递参数，如对于 int sum(int a, int b)，可使用call sum(1, 2)</td>
</tr>
<tr>
<td style="text-align:left">q(uit)</td>
<td>退出gdb调试器</td>
</tr>
<tr>
<td style="text-align:left">b(reak )</td>
<td>设置断点</td>
</tr>
<tr>
<td style="text-align:left">info r</td>
<td>查看寄存器</td>
</tr>
<tr>
<td style="text-align:left">p</td>
<td>输出变量</td>
</tr>
<tr>
<td style="text-align:left">x</td>
<td>查看内容</td>
</tr>
<tr>
<td style="text-align:left">set args</td>
<td>设置函数运行参数</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>设置断点</strong></li>
</ul>
<hr>
<h3 id="WriteUp">WriteUp</h3>
<p>​	题目一共给了6个bombs，打开<code>bomb.c</code>查看部分源码，其实关键在于这几段</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210326172525304.png" alt="image-20210326172525304"></p>
<p>程序读取<code>input</code>字符串，如果输入<code>正确的</code>字符串，那么就拆解成功一个炸弹，<s>否则你就会像下图一样被blown up</s></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210326173121180.png" alt="image-20210326173121180"></p>
<p>先执行下面的指令得到程序的反汇编代码，然后我们进行愉快的拆解</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$objdump</span> <span class="token parameter variable">-d</span> bomb <span class="token operator">></span> bomb.asm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>
<h4 id="phase1">phase1</h4>
<p>在bomb.asm中找到<code>phase_1()</code>的汇编代码段如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210326181958171.png" alt="image-20210326181958171"></p>
<p>这里关于寄存器的几点需要补充：</p>
<ul>
<li>%rdi:  保存了函数入口的<strong>第一个</strong>参数</li>
<li>%rsi:  保存了函数入口的<strong>第二个</strong>参数</li>
<li>%rdx: 保存了函数入口的<strong>第三个</strong>参数</li>
<li>%rcx: 保存了函数入口的<strong>第四个</strong>参数</li>
<li>%rax：函数的<strong>返回值</strong></li>
</ul>
<p>由此，要避免0x400ef2处触发explode_bomb，需要在上一行进行跳转，跳转条件**%eax值为0**（test是先进行与运算再设置PSW的，判断相等的条件为<strong>ZF==0</strong>），因此我们去strings_not_equal处的汇编代码查看</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210326182825730.png" alt="image-20210326182825730"></p>
<p>输入参数为%rdi和%rsi，返回值为%rax，当两个输入存储的值不相等时，返回%eax值1，可以确定，<strong>%si存储了待比较的字符串</strong>，也就是bomb1的key，因此我们在该函数处设置断点，并以字符串的形式打印%si中的值</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$gdb</span> bomb
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span>break strings_not_equal
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span>r
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token punctuation">(</span>char*<span class="token punctuation">)</span><span class="token variable">$rsi</span>
<span class="token variable">$1</span> <span class="token operator">=</span> 0x402400 <span class="token string">"Border relations with Canada have never been better."</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token punctuation">(</span>char*<span class="token punctuation">)</span><span class="token variable">$rdi</span>
<span class="token variable">$2</span> <span class="token operator">=</span> 0x603780 <span class="token operator">&lt;</span>input_strings<span class="token operator">></span> <span class="token string">"2333"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>因此，bomb1的key为：<strong>Border relations with Canada have never been better.</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210326183755389.png" alt="image-20210326183755389"></p>
<p>bomb1拆除成功。</p>
</li>
<li>
<h4 id="phase2">phase2</h4>
<p><code>phase_2()</code>的汇编代码如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210326184232130.png" alt="image-20210326184232130"></p>
<p>这里不难看到<code>phase_2()</code>其实先利用<code>read_six_numbers</code>读入6个数，再逐个比较。数字比较部分的代码分析如下：</p>
<p>注意：</p>
<ul>
<li>%rsp生长方向为地址减小的方向，因此，对于存储在%rsp中的<code>arr</code>首地址，<code>lea 0x4(%rsp), %rbx</code>实际表示为<code>%rbx = arr[i + 1]</code></li>
</ul>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">0000000000400efc &lt;phase_2&gt;:
  400efc:	55                   	push   %rbp
  400efd:	53                   	push   %rbx
  400efe:	48 83 ec 28          	sub    $0x28,%rsp         &#x2F;&#x2F;开辟栈空间
  400f02:	48 89 e6             	mov    %rsp,%rsi		&#x2F;&#x2F;%rsp实际上保存了数组的首地址，
  400f05:	e8 52 05 00 00       	callq  40145c &lt;read_six_numbers&gt;
  400f0a:	83 3c 24 01          	cmpl   $0x1,(%rsp)			&#x2F;&#x2F;1. arr[0] &#x3D; 1
  400f0e:	74 20                	je     400f30 &lt;phase_2+0x34&gt;	
  400f10:	e8 25 05 00 00       	callq  40143a &lt;explode_bomb&gt;
  400f15:	eb 19                	jmp    400f30 &lt;phase_2+0x34&gt;
  400f17:	8b 43 fc             	mov    -0x4(%rbx),%eax		&#x2F;&#x2F;4. %eax &#x3D; arr[?-1]
  400f1a:	01 c0                	add    %eax,%eax			&#x2F;&#x2F;5. %eax *&#x3D; 2
  400f1c:	39 03                	cmp    %eax,(%rbx)			&#x2F;&#x2F;6. if %eax &#x3D;&#x3D; arr[?] 
  400f1e:	74 05                	je     400f25 &lt;phase_2+0x29&gt;&#x2F;&#x2F;
  400f20:	e8 15 05 00 00       	callq  40143a &lt;explode_bomb&gt;
  400f25:	48 83 c3 04          	add    $0x4,%rbx			&#x2F;&#x2F;7. arr[?+1]
  400f29:	48 39 eb             	cmp    %rbp,%rbx			&#x2F;&#x2F;8. arr[?] !&#x3D; arr[6],loop to 4
  400f2c:	75 e9                	jne    400f17 &lt;phase_2+0x1b&gt;
  400f2e:	eb 0c                	jmp    400f3c &lt;phase_2+0x40&gt;
  400f30:	48 8d 5c 24 04       	lea    0x4(%rsp),%rbx		&#x2F;&#x2F;2. (%rbx) &#x3D; arr[1]
  400f35:	48 8d 6c 24 18       	lea    0x18(%rsp),%rbp		&#x2F;&#x2F;3. (%rbp) &#x3D; arr[6]，0x18是十进制的24
  400f3a:	eb db                	jmp    400f17 &lt;phase_2+0x1b&gt;
  400f3c:	48 83 c4 28          	add    $0x28,%rsp
  400f40:	5b                   	pop    %rbx
  400f41:	5d                   	pop    %rbp
  400f42:	c3                   	retq  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>根据对汇编代码的分析，可以得知代码的逻辑如下：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token function">explode_bomb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">int</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>tmp <span class="token operator">!=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token function">explode_bomb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>因此，<code>phase_2()</code>的key为首项为1，公比为2的等比数列的前6项：<strong>1 2 4 8 16 32</strong></p>
</li>
<li>
<h4 id="phase3">phase3</h4>
<p>先让我们看一下源码</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">0000000000400f43 &lt;phase_3&gt;:
  400f43:	48 83 ec 18          	sub    $0x18,%rsp
  400f47:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx
  400f4c:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx	
  400f51:	be cf 25 40 00       	mov    $0x4025cf,%esi
  400f56:	b8 00 00 00 00       	mov    $0x0,%eax
  400f5b:	e8 90 fc ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;	&#x2F;&#x2F;sscanf返回读取到的item个数
  400f60:	83 f8 01             	cmp    $0x1,%eax
  400f63:	7f 05                	jg     400f6a &lt;phase_3+0x27&gt;
  400f65:	e8 d0 04 00 00       	callq  40143a &lt;explode_bomb&gt;
  400f6a:	83 7c 24 08 07       	cmpl   $0x7,0x8(%rsp)		
  400f6f:	77 3c                	ja     400fad &lt;phase_3+0x6a&gt;	&#x2F;&#x2F;num1&gt;7,bomb()
  400f71:	8b 44 24 08          	mov    0x8(%rsp),%eax			&#x2F;&#x2F;eax &#x3D; num1
  400f75:	ff 24 c5 70 24 40 00 	jmpq   *0x402470(,%rax,8)		&#x2F;&#x2F;(0x402470[8*num1])处的值
  400f7c:	b8 cf 00 00 00       	mov    $0xcf,%eax				
  400f81:	eb 3b                	jmp    400fbe &lt;phase_3+0x7b&gt;
  400f83:	b8 c3 02 00 00       	mov    $0x2c3,%eax
  400f88:	eb 34                	jmp    400fbe &lt;phase_3+0x7b&gt;
  400f8a:	b8 00 01 00 00       	mov    $0x100,%eax
  400f8f:	eb 2d                	jmp    400fbe &lt;phase_3+0x7b&gt;
  400f91:	b8 85 01 00 00       	mov    $0x185,%eax
  400f96:	eb 26                	jmp    400fbe &lt;phase_3+0x7b&gt;
  400f98:	b8 ce 00 00 00       	mov    $0xce,%eax
  400f9d:	eb 1f                	jmp    400fbe &lt;phase_3+0x7b&gt;
  400f9f:	b8 aa 02 00 00       	mov    $0x2aa,%eax
  400fa4:	eb 18                	jmp    400fbe &lt;phase_3+0x7b&gt;
  400fa6:	b8 47 01 00 00       	mov    $0x147,%eax
  400fab:	eb 11                	jmp    400fbe &lt;phase_3+0x7b&gt;
  400fad:	e8 88 04 00 00       	callq  40143a &lt;explode_bomb&gt;
  400fb2:	b8 00 00 00 00       	mov    $0x0,%eax
  400fb7:	eb 05                	jmp    400fbe &lt;phase_3+0x7b&gt;
  400fb9:	b8 37 01 00 00       	mov    $0x137,%eax
  400fbe:	3b 44 24 0c          	cmp    0xc(%rsp),%eax
  400fc2:	74 05                	je     400fc9 &lt;phase_3+0x86&gt;
  400fc4:	e8 71 04 00 00       	callq  40143a &lt;explode_bomb&gt;
  400fc9:	48 83 c4 18          	add    $0x18,%rsp
  400fcd:	c3                   	retq   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>源码中可以看到调用了<code>sscanf</code>库函数，该函数表示返回读入参数的个数，我们设置断点查看</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span>break *0x400f60
---
phase_3<span class="token punctuation">(</span><span class="token punctuation">)</span>:
INPUT:2 <span class="token number">3</span> <span class="token number">3</span> <span class="token number">3</span>
---
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span>info r eax
eax            0x2                 <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>因此phase_3()只读取两个参数，查看0x8(%rsp)和0xc(%rsp)</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">Breakpoint 1, 0x0000000000400f60 in phase_3 ()
(gdb) x $sp
0x7fffffffdf00:	0x00402210
(gdb) x $rsp
0x7fffffffdf00:	0x00402210
(gdb) x $rsp+0x8
0x7fffffffdf08:	0x00000002
(gdb) x $rsp+0xc
0x7fffffffdf0c:	0x00000003<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>分别放在<code>0x8(%rsp)</code>和<code>0xc(%sp)</code>（输入的参数入栈，最后一个在栈底<code>0xc</code>，高地址；第一个在栈顶，低地址<code>0x8</code>），我们假设两处输入的参数分别为<code>num1</code>和<code>num2</code>，且0&lt;=<code>num1</code>&lt;=7（<strong>ja只判定无符号数</strong>），num1被存储在%eax中，根据</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">400f75:	ff 24 c5 70 24 40 00 	jmpq   *0x402470(,%rax,8)		&#x2F;&#x2F;(0x402470[8*num1])处的值<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>可知，根据输入不同的num1，需要跳转到不同的地址处，我们从0x402470开始连续打印8个地址（x64机器每个地址8个字节）</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">(gdb) x&#x2F;8xg 0x402470
0x402470:       0x0000000000400f7c      0x0000000000400fb9
0x402480:       0x0000000000400f83      0x0000000000400f8a
0x402490:       0x0000000000400f91      0x0000000000400f98
0x4024a0:       0x0000000000400f9f      0x0000000000400fa6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>所以根据num1=[0…7]，分别前往源码中不同的地址处对%eax赋值操作，跳转处标记在源码中</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">400f7c:	b8 cf 00 00 00       	mov    $0xcf,%eax				&#x2F;&#x2F;num1&#x3D;0,eax&#x3D;0xcf&#x3D;207
400f81:	eb 3b                	jmp    400fbe &lt;phase_3+0x7b&gt;
400f83:	b8 c3 02 00 00       	mov    $0x2c3,%eax				&#x2F;&#x2F;num1&#x3D;2,eax&#x3D;0x2c3&#x3D;707
400f88:	eb 34                	jmp    400fbe &lt;phase_3+0x7b&gt;
400f8a:	b8 00 01 00 00       	mov    $0x100,%eax				&#x2F;&#x2F;num1&#x3D;3,eax&#x3D;0x100&#x3D;256
400f8f:	eb 2d                	jmp    400fbe &lt;phase_3+0x7b&gt;
400f91:	b8 85 01 00 00       	mov    $0x185,%eax				&#x2F;&#x2F;num1&#x3D;4,eax&#x3D;0x185&#x3D;389
400f96:	eb 26                	jmp    400fbe &lt;phase_3+0x7b&gt;
400f98:	b8 ce 00 00 00       	mov    $0xce,%eax				&#x2F;&#x2F;num1&#x3D;5,eax&#x3D;0xce&#x3D;206
400f9d:	eb 1f                	jmp    400fbe &lt;phase_3+0x7b&gt;
400f9f:	b8 aa 02 00 00       	mov    $0x2aa,%eax				&#x2F;&#x2F;num1&#x3D;6,eax&#x3D;0x2aa&#x3D;682
400fa4:	eb 18                	jmp    400fbe &lt;phase_3+0x7b&gt;
400fa6:	b8 47 01 00 00       	mov    $0x147,%eax				&#x2F;&#x2F;num1&#x3D;7,eax&#x3D;0x147&#x3D;327
400fab:	eb 11                	jmp    400fbe &lt;phase_3+0x7b&gt;
400fad:	e8 88 04 00 00       	callq  40143a &lt;explode_bomb&gt;
400fb2:	b8 00 00 00 00       	mov    $0x0,%eax
400fb7:	eb 05                	jmp    400fbe &lt;phase_3+0x7b&gt;
400fb9:	b8 37 01 00 00       	mov    $0x137,%eax			&#x2F;&#x2F;num1&#x3D;1,eax&#x3D;0x137&#x3D;311
400fbe:	3b 44 24 0c          	cmp    0xc(%rsp),%eax		&#x2F;&#x2F;num2 &#x3D;&#x3D; eax? (defused()) : bomb
400fc2:	74 05                	je     400fc9 &lt;phase_3+0x86&gt;
400fc4:	e8 71 04 00 00       	callq  40143a &lt;explode_bomb&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>因此，phase_3()的key：num1 num2，对应以下8组中任意一组即可：</p>
<table>
<thead>
<tr>
<th>num1</th>
<th>num2</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>207</td>
</tr>
<tr>
<td>1</td>
<td>311</td>
</tr>
<tr>
<td>2</td>
<td>707</td>
</tr>
<tr>
<td>3</td>
<td>256</td>
</tr>
<tr>
<td>4</td>
<td>389</td>
</tr>
<tr>
<td>5</td>
<td>206</td>
</tr>
<tr>
<td>6</td>
<td>682</td>
</tr>
<tr>
<td>7</td>
<td>327</td>
</tr>
</tbody>
</table>
</li>
<li>
<h4 id="phase4">phase4</h4>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">000000000040100c &lt;phase_4&gt;:
  40100c:	48 83 ec 18          	sub    $0x18,%rsp
  401010:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx	%rcx&#x3D;num2
  401015:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx
  40101a:	be cf 25 40 00       	mov    $0x4025cf,%esi
  40101f:	b8 00 00 00 00       	mov    $0x0,%eax
  401024:	e8 c7 fb ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;
  401029:	83 f8 02             	cmp    $0x2,%eax
  40102c:	75 07                	jne    401035 &lt;phase_4+0x29&gt;	
  40102e:	83 7c 24 08 0e       	cmpl   $0xe,0x8(%rsp)
  401033:	76 05                	jbe    40103a &lt;phase_4+0x2e&gt;	&#x2F;&#x2F;num1 &lt;&#x3D; 0xe(14)
  401035:	e8 00 04 00 00       	callq  40143a &lt;explode_bomb&gt;
  40103a:	ba 0e 00 00 00       	mov    $0xe,%edx			&#x2F;&#x2F;edx &#x3D; 14
  40103f:	be 00 00 00 00       	mov    $0x0,%esi			&#x2F;&#x2F;esi &#x3D; 0
  401044:	8b 7c 24 08          	mov    0x8(%rsp),%edi		&#x2F;&#x2F;edi &#x3D; num1
  401048:	e8 81 ff ff ff       	callq  400fce &lt;func4&gt;
  40104d:	85 c0                	test   %eax,%eax
  40104f:	75 07                	jne    401058 &lt;phase_4+0x4c&gt;
  401051:	83 7c 24 0c 00       	cmpl   $0x0,0xc(%rsp)
  401056:	74 05                	je     40105d &lt;phase_4+0x51&gt;
  401058:	e8 dd 03 00 00       	callq  40143a &lt;explode_bomb&gt;
  40105d:	48 83 c4 18          	add    $0x18,%rsp
  401061:	c3                   	retq  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>依然是读入两个参数num1(0x8(%rsp))和num2(0xc(%rsp))，且由跳转函数可以得到0&lt;=<code>num1</code>&lt;=14，经过了三个寄存器的赋值以后，函数跳转到<code>fun4</code>，不过在这之前我们可以看到，在后续的汇编代码中，需要满足<code>%eax = 0</code>和<code>num2=0</code>两个条件。以下是func4的汇编代码：</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">0000000000400fce &lt;func4&gt;:&#x2F;&#x2F;已知的参数:%edx&#x3D;14,%esi&#x3D;0,%edi&#x3D;num1
  400fce:	48 83 ec 08          	sub    $0x8,%rsp
  400fd2:	89 d0                	mov    %edx,%eax	&#x2F;&#x2F;%eax&#x3D;14
  400fd4:	29 f0                	sub    %esi,%eax	&#x2F;&#x2F;%eax -&#x3D; (%esi)
  400fd6:	89 c1                	mov    %eax,%ecx	&#x2F;&#x2F;%ecx&#x3D;%eax
  400fd8:	c1 e9 1f             	shr    $0x1f,%ecx	&#x2F;&#x2F;取%ecx的符号位 
  400fdb:	01 c8                	add    %ecx,%eax	&#x2F;&#x2F;%eax +&#x3D; %ecx
  400fdd:	d1 f8                	sar    %eax
  400fdf:	8d 0c 30             	lea    (%rax,%rsi,1),%ecx
  400fe2:	39 f9                	cmp    %edi,%ecx	&#x2F;&#x2F;num1 &gt;&#x3D; %ecx
  400fe4:	7e 0c                	jle    400ff2 &lt;func4+0x24&gt;
  400fe6:	8d 51 ff             	lea    -0x1(%rcx),%edx	%edx&#x3D;%rcx-1
  400fe9:	e8 e0 ff ff ff       	callq  400fce &lt;func4&gt;
  400fee:	01 c0                	add    %eax,%eax		%eax*&#x3D;2
  400ff0:	eb 15                	jmp    401007 &lt;func4+0x39&gt;&#x2F;&#x2F;done
  400ff2:	b8 00 00 00 00       	mov    $0x0,%eax	&#x2F;&#x2F;%eax&#x3D;0
  400ff7:	39 f9                	cmp    %edi,%ecx	&#x2F;&#x2F;num1&lt;&#x3D;%ecx，done
  400ff9:	7d 0c                	jge    401007 &lt;func4+0x39&gt;
  400ffb:	8d 71 01             	lea    0x1(%rcx),%esi	&#x2F;&#x2F;%esi&#x3D;%rcx+1
  400ffe:	e8 cb ff ff ff       	callq  400fce &lt;func4&gt;
  401003:	8d 44 00 01          	lea    0x1(%rax,%rax,1),%eax
  401007:	48 83 c4 08          	add    $0x8,%rsp
  40100b:	c3                   	retq <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>注：类似于  cmp    %edi,%ecx	jle    400ff2 &lt;func4+0x24&gt;；跳转语句的主语是dst，如左边这句表示，compare %edi : %ecx，若 %ecx &lt;=(lower or equal) %edi，则jump到0x400ff2处</p>
</blockquote>
<p>分析两次跳转条件，可以得到<code>%ecx=num1</code>，即可返回<code>%eax=0</code>，汇编代码里面用了比较多的递归，为了方便计算我们画出算法流程图后写个测试函数看看num1应该是多少：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">fun4</span><span class="token punctuation">(</span><span class="token keyword">int</span> dx<span class="token punctuation">,</span> <span class="token keyword">int</span> si<span class="token punctuation">,</span> <span class="token keyword">int</span> di<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">int</span> ax <span class="token operator">=</span> dx <span class="token operator">-</span> si<span class="token punctuation">;</span>
   <span class="token keyword">int</span> cx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span>ax <span class="token operator">>></span> <span class="token number">31</span><span class="token punctuation">;</span>
   ax <span class="token operator">=</span> <span class="token punctuation">(</span>ax <span class="token operator">+</span> cx<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span>
   cx <span class="token operator">=</span> ax <span class="token operator">+</span> si<span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>di <span class="token operator">>=</span> cx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      ax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>di <span class="token operator">&lt;=</span> cx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token keyword">return</span> ax<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>  
      <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
         si <span class="token operator">=</span> cx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
         ax <span class="token operator">=</span> <span class="token function">fun4</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> si<span class="token punctuation">,</span> di<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> <span class="token number">2</span><span class="token operator">*</span>ax <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span>
   <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      dx <span class="token operator">=</span> cx <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
      ax <span class="token operator">=</span> <span class="token function">fun4</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> si<span class="token punctuation">,</span> di<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> ax<span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> num1 <span class="token operator">&lt;=</span> <span class="token number">14</span><span class="token punctuation">;</span> <span class="token operator">++</span>num1<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fun4</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> num1<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> num1<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token operator">--</span><span class="token operator">--</span>运行结果<span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">0</span>
<span class="token number">1</span>
<span class="token number">3</span>
<span class="token number">7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>所以**phase_4()**的key为如下4组中的任意一组即可：</p>
<p><strong>0 0</strong></p>
<p><strong>1 0</strong></p>
<p><strong>3 0</strong></p>
<p><strong>7 0</strong></p>
</li>
<li>
<h4 id="phase5">phase5</h4>
<p>反汇编代码如下：</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">0000000000401062 &lt;phase_5&gt;:
  401062:	53                   	push   %rbx
  401063:	48 83 ec 20          	sub    $0x20,%rsp
  401067:	48 89 fb             	mov    %rdi,%rbx
  40106a:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax
  401071:	00 00 
  401073:	48 89 44 24 18       	mov    %rax,0x18(%rsp)
  401078:	31 c0                	xor    %eax,%eax
  40107a:	e8 9c 02 00 00       	callq  40131b &lt;string_length&gt;
  40107f:	83 f8 06             	cmp    $0x6,%eax
  401082:	74 4e                	je     4010d2 &lt;phase_5+0x70&gt;
  401084:	e8 b1 03 00 00       	callq  40143a &lt;explode_bomb&gt;
  401089:	eb 47                	jmp    4010d2 &lt;phase_5+0x70&gt;
  40108b:	0f b6 0c 03          	movzbl (%rbx,%rax,1),%ecx
  40108f:	88 0c 24             	mov    %cl,(%rsp)
  401092:	48 8b 14 24          	mov    (%rsp),%rdx
  401096:	83 e2 0f             	and    $0xf,%edx
  401099:	0f b6 92 b0 24 40 00 	movzbl 0x4024b0(%rdx),%edx
  4010a0:	88 54 04 10          	mov    %dl,0x10(%rsp,%rax,1)
  4010a4:	48 83 c0 01          	add    $0x1,%rax
  4010a8:	48 83 f8 06          	cmp    $0x6,%rax
  4010ac:	75 dd                	jne    40108b &lt;phase_5+0x29&gt;
  4010ae:	c6 44 24 16 00       	movb   $0x0,0x16(%rsp)
  4010b3:	be 5e 24 40 00       	mov    $0x40245e,%esi
  4010b8:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi
  4010bd:	e8 76 02 00 00       	callq  401338 &lt;strings_not_equal&gt;
  4010c2:	85 c0                	test   %eax,%eax
  4010c4:	74 13                	je     4010d9 &lt;phase_5+0x77&gt;
  4010c6:	e8 6f 03 00 00       	callq  40143a &lt;explode_bomb&gt;
  4010cb:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)
  4010d0:	eb 07                	jmp    4010d9 &lt;phase_5+0x77&gt;
  4010d2:	b8 00 00 00 00       	mov    $0x0,%eax
  4010d7:	eb b2                	jmp    40108b &lt;phase_5+0x29&gt;
  4010d9:	48 8b 44 24 18       	mov    0x18(%rsp),%rax
  4010de:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax
  4010e5:	00 00 
  4010e7:	74 05                	je     4010ee &lt;phase_5+0x8c&gt;
  4010e9:	e8 42 fa ff ff       	callq  400b30 &lt;__stack_chk_fail@plt&gt;
  4010ee:	48 83 c4 20          	add    $0x20,%rsp
  4010f2:	5b                   	pop    %rbx
  4010f3:	c3                   	retq <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>从0x40107f处可以看到，phase5需要我们输入长度为<code>6</code>的字符串，我们先输入长度为6的字符串，并在0x40108b处设置断点，可以看到</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">(gdb) p (char*)$rbx
$2 &#x3D; 0x6038c0 &lt;input_strings+320&gt; &quot;abcdef&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>%rbx存储了我们输入字符串的首地址，可以看到0x4010ac处之前是在sp中存储这6位字符，然后直到0x4010bd处比较字符串。这样我们其实可以直接查询%rsi存储的地址处的字符串</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">(gdb) p (char*)$esi
$5 &#x3D; 0x40245e &quot;flyers&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>这就结束了？**不！**这不只是简单比较一下字符串就行，此前对输入的字符串进行了转换映射。我们将如下的汇编代码用高级语言改写：</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">40108b:	0f b6 0c 03          	movzbl (%rbx,%rax,1),%ecx
40108f:	88 0c 24             	mov    %cl,(%rsp)
401092:	48 8b 14 24          	mov    (%rsp),%rdx
401096:	83 e2 0f             	and    $0xf,%edx
401099:	0f b6 92 b0 24 40 00 	movzbl 0x4024b0(%rdx),%edx
4010a0:	88 54 04 10          	mov    %dl,0x10(%rsp,%rax,1)
4010a4:	48 83 c0 01          	add    $0x1,%rax
4010a8:	48 83 f8 06          	cmp    $0x6,%rax
4010ac:	75 dd                	jne    40108b &lt;phase_5+0x29&gt;
------
%rbx：我们输入的字符，设定为 inputs[i]，经过与0x4024b0的字符运算后存储在0x10(%rsp)处
0x4024b0：事先存储的字符，设定为arr[i]
 int sp[6];
 for (int i &#x3D; 0; i &lt; 6; ++i) 
    sp[i] &#x3D; arr[inputs[i] &amp; 0xf];
------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对于任意一个数num，有<code>num&amp;0xf&lt;=0xf</code>，因此我们可以查看0x4024b0处开始的16个字符</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210329113622421.png" alt="image-20210329113622421"></p>
<p>可以得到</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'m'</span><span class="token punctuation">,</span> <span class="token char">'a'</span><span class="token punctuation">,</span> <span class="token char">'d'</span><span class="token punctuation">,</span> <span class="token char">'u'</span><span class="token punctuation">,</span> <span class="token char">'i'</span><span class="token punctuation">,</span> <span class="token char">'e'</span><span class="token punctuation">,</span> <span class="token char">'r'</span><span class="token punctuation">,</span> <span class="token char">'s'</span><span class="token punctuation">,</span> <span class="token char">'n'</span><span class="token punctuation">,</span> <span class="token char">'f'</span><span class="token punctuation">,</span> <span class="token char">'o'</span><span class="token punctuation">,</span><span class="token char">' t'</span><span class="token punctuation">,</span> <span class="token char">'v'</span><span class="token punctuation">,</span> <span class="token char">'b'</span><span class="token punctuation">,</span> <span class="token char">'y'</span><span class="token punctuation">,</span> <span class="token char">'l'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>最终0x10(%rsp)处的字符（也即sp[]）被映射到%rdi处，%rsi处的字符为</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210329113943236.png" alt="image-20210329113943236"></p>
<p>所以只需要找到合适的<code>inputs</code>，并作映射<code>sp[i]=arr[inputs[i]&amp;0xf]</code>，使得<code>string(sp)==&quot;flyers&quot; </code>，写个测试函数找一找：</p>
<pre class="line-numbers language-c++" data-language="c++"><code class="language-c++">    string arr &#x3D; &quot;maduiersnfotvbyl&quot;;
    string si &#x3D; &quot;flyers&quot;;
    for (int i &#x3D; 0; i &lt; 6; ++i) &#123;
        cout &lt;&lt; si[i] &lt;&lt; &quot;: &quot;;
        for (int k &#x3D; 0; k &lt; 128; k++)
            if (arr[int(k &amp; 0xf)] &#x3D;&#x3D; si[i])
                cout &lt;&lt; (char)k;
        cout &lt;&lt; endl;
    &#125;
----
f: )9IYiy
l: &#x2F;?O_o
y: .&gt;N^n~
e: %5EUeu
r: &amp;6FVfv
s: &#39;7GWgw<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上<strong>6行字符的任意排列组合</strong>均可拆除phase5()</p>
<p>其实这里有个彩蛋，<code>Ctrl+C</code>可以直接拆弹，这是我没想到的2333</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210329130013620.png" alt="image-20210329130013620"></p>
</li>
<li>
<h4 id="phase6">phase6</h4>
<p>激动人心的时刻，终于来到最后一个phase了，让我们继续看一下源码</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">00000000004010f4 &lt;phase_6&gt;:
  4010f4:	41 56                	push   %r14
  4010f6:	41 55                	push   %r13
  4010f8:	41 54                	push   %r12
  4010fa:	55                   	push   %rbp
  4010fb:	53                   	push   %rbx
  4010fc:	48 83 ec 50          	sub    $0x50,%rsp
  401100:	49 89 e5             	mov    %rsp,%r13
  401103:	48 89 e6             	mov    %rsp,%rsi
  401106:	e8 51 03 00 00       	callq  40145c &lt;read_six_numbers&gt;
  40110b:	49 89 e6             	mov    %rsp,%r14
  40110e:	41 bc 00 00 00 00    	mov    $0x0,%r12d
  401114:	4c 89 ed             	mov    %r13,%rbp
  401117:	41 8b 45 00          	mov    0x0(%r13),%eax
  40111b:	83 e8 01             	sub    $0x1,%eax
  40111e:	83 f8 05             	cmp    $0x5,%eax
  401121:	76 05                	jbe    401128 &lt;phase_6+0x34&gt;
  401123:	e8 12 03 00 00       	callq  40143a &lt;explode_bomb&gt;
  401128:	41 83 c4 01          	add    $0x1,%r12d
  40112c:	41 83 fc 06          	cmp    $0x6,%r12d
  401130:	74 21                	je     401153 &lt;phase_6+0x5f&gt;
  401132:	44 89 e3             	mov    %r12d,%ebx
  401135:	48 63 c3             	movslq %ebx,%rax
  401138:	8b 04 84             	mov    (%rsp,%rax,4),%eax
  40113b:	39 45 00             	cmp    %eax,0x0(%rbp)
  40113e:	75 05                	jne    401145 &lt;phase_6+0x51&gt;
  401140:	e8 f5 02 00 00       	callq  40143a &lt;explode_bomb&gt;
  401145:	83 c3 01             	add    $0x1,%ebx
  401148:	83 fb 05             	cmp    $0x5,%ebx
  40114b:	7e e8                	jle    401135 &lt;phase_6+0x41&gt;
  40114d:	49 83 c5 04          	add    $0x4,%r13
  401151:	eb c1                	jmp    401114 &lt;phase_6+0x20&gt;
  401153:	48 8d 74 24 18       	lea    0x18(%rsp),%rsi
  401158:	4c 89 f0             	mov    %r14,%rax
  40115b:	b9 07 00 00 00       	mov    $0x7,%ecx
  401160:	89 ca                	mov    %ecx,%edx
  401162:	2b 10                	sub    (%rax),%edx
  401164:	89 10                	mov    %edx,(%rax)
  401166:	48 83 c0 04          	add    $0x4,%rax
  40116a:	48 39 f0             	cmp    %rsi,%rax
  40116d:	75 f1                	jne    401160 &lt;phase_6+0x6c&gt;
  40116f:	be 00 00 00 00       	mov    $0x0,%esi
  401174:	eb 21                	jmp    401197 &lt;phase_6+0xa3&gt;
  401176:	48 8b 52 08          	mov    0x8(%rdx),%rdx
  40117a:	83 c0 01             	add    $0x1,%eax
  40117d:	39 c8                	cmp    %ecx,%eax
  40117f:	75 f5                	jne    401176 &lt;phase_6+0x82&gt;
  401181:	eb 05                	jmp    401188 &lt;phase_6+0x94&gt;
  401183:	ba d0 32 60 00       	mov    $0x6032d0,%edx
  401188:	48 89 54 74 20       	mov    %rdx,0x20(%rsp,%rsi,2)
  40118d:	48 83 c6 04          	add    $0x4,%rsi
  401191:	48 83 fe 18          	cmp    $0x18,%rsi
  401195:	74 14                	je     4011ab &lt;phase_6+0xb7&gt;
  401197:	8b 0c 34             	mov    (%rsp,%rsi,1),%ecx
  40119a:	83 f9 01             	cmp    $0x1,%ecx
  40119d:	7e e4                	jle    401183 &lt;phase_6+0x8f&gt;
  40119f:	b8 01 00 00 00       	mov    $0x1,%eax
  4011a4:	ba d0 32 60 00       	mov    $0x6032d0,%edx
  4011a9:	eb cb                	jmp    401176 &lt;phase_6+0x82&gt;
  4011ab:	48 8b 5c 24 20       	mov    0x20(%rsp),%rbx
  4011b0:	48 8d 44 24 28       	lea    0x28(%rsp),%rax
  4011b5:	48 8d 74 24 50       	lea    0x50(%rsp),%rsi
  4011ba:	48 89 d9             	mov    %rbx,%rcx
  4011bd:	48 8b 10             	mov    (%rax),%rdx
  4011c0:	48 89 51 08          	mov    %rdx,0x8(%rcx)
  4011c4:	48 83 c0 08          	add    $0x8,%rax
  4011c8:	48 39 f0             	cmp    %rsi,%rax
  4011cb:	74 05                	je     4011d2 &lt;phase_6+0xde&gt;
  4011cd:	48 89 d1             	mov    %rdx,%rcx
  4011d0:	eb eb                	jmp    4011bd &lt;phase_6+0xc9&gt;
  4011d2:	48 c7 42 08 00 00 00 	movq   $0x0,0x8(%rdx)
  4011d9:	00 
  4011da:	bd 05 00 00 00       	mov    $0x5,%ebp
  4011df:	48 8b 43 08          	mov    0x8(%rbx),%rax
  4011e3:	8b 00                	mov    (%rax),%eax
  4011e5:	39 03                	cmp    %eax,(%rbx)
  4011e7:	7d 05                	jge    4011ee &lt;phase_6+0xfa&gt;
  4011e9:	e8 4c 02 00 00       	callq  40143a &lt;explode_bomb&gt;
  4011ee:	48 8b 5b 08          	mov    0x8(%rbx),%rbx
  4011f2:	83 ed 01             	sub    $0x1,%ebp
  4011f5:	75 e8                	jne    4011df &lt;phase_6+0xeb&gt;
  4011f7:	48 83 c4 50          	add    $0x50,%rsp
  4011fb:	5b                   	pop    %rbx
  4011fc:	5d                   	pop    %rbp
  4011fd:	41 5c                	pop    %r12
  4011ff:	41 5d                	pop    %r13
  401201:	41 5e                	pop    %r14
  401203:	c3                   	retq   
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>比以往的长了很多，不过从输入处我们还是可以看到，此phase依然是读入6个数，我们逐段分析一下</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">40110b:	49 89 e6             	mov    %rsp,%r14
40110e:	41 bc 00 00 00 00    	mov    $0x0,%r12d
401114:	4c 89 ed             	mov    %r13,%rbp
401117:	41 8b 45 00          	mov    0x0(%r13),%eax
40111b:	83 e8 01             	sub    $0x1,%eax
40111e:	83 f8 05             	cmp    $0x5,%eax
401121:	76 05                	jbe    401128 &lt;phase_6+0x34&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<p>​        可以得到以下信息</p>
<ul>
<li>
<p>输入的6个数字保存在%rsp、%rbp、%r13、%r14中，且存储的均为数组的首地址，我们假设该数组为<strong>arr[]</strong></p>
</li>
<li>
<p>arr[0]-1&lt;=5</p>
<p>继续往下看到0x401153</p>
<pre class="line-numbers language-asm" data-language="asm"><code class="language-asm">  401114:	4c 89 ed             	mov    %r13,%rbp
  
  401117:	41 8b 45 00          	mov    0x0(%r13),%eax
  40111b:	83 e8 01             	sub    $0x1,%eax
  40111e:	83 f8 05             	cmp    $0x5,%eax
  401121:	76 05                	jbe    401128 &lt;phase_6+0x34&gt;
  401123:	e8 12 03 00 00       	callq  40143a &lt;explode_bomb&gt;
  
  401128:	41 83 c4 01          	add    $0x1,%r12d
  40112c:	41 83 fc 06          	cmp    $0x6,%r12d
  401130:	74 21                	je     401153 &lt;phase_6+0x5f&gt;
  401132:	44 89 e3             	mov    %r12d,%ebx
  
  401135:	48 63 c3             	movslq %ebx,%rax
  401138:	8b 04 84             	mov    (%rsp,%rax,4),%eax
  40113b:	39 45 00             	cmp    %eax,0x0(%rbp)
  40113e:	75 05                	jne    401145 &lt;phase_6+0x51&gt;
  401140:	e8 f5 02 00 00       	callq  40143a &lt;explode_bomb&gt;
  
  401145:	83 c3 01             	add    $0x1,%ebx
  401148:	83 fb 05             	cmp    $0x5,%ebx
  40114b:	7e e8                	jle    401135 &lt;phase_6+0x41&gt;
40114d:	49 83 c5 04          	add    $0x4,%r13
  401151:	eb c1                	jmp    401114 &lt;phase_6+0x20&gt;
  
  401153:	48 8d 74 24 18       	lea    0x18(%rsp),%rsi
  ------
  大意如下：
  for (int i &#x3D; 0; i &lt; 6; ++i) &#123;
  	if (arr[i] &gt; 6)
  		bomb();
  	for (int j &#x3D; i + 1; j &lt; 6; ++j)
  		if (arr[j] &#x3D;&#x3D; arr[i])
  			bomb();
  &#125;
  ------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>(这一段挺麻烦的orz…整个phase6我看了整整一天)，总之上一段程序可以得到如下结论</p>
<ul>
<li><strong>输入的6个数字互不相等且不超过6</strong></li>
</ul>
<p>继续往下分析：</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">401153:	48 8d 74 24 18       	lea    0x18(%rsp),%rsi	&#x2F;&#x2F;si&#x3D;arr.end()
401158:	4c 89 f0             	mov    %r14,%rax
40115b:	b9 07 00 00 00       	mov    $0x7,%ecx
401160:	89 ca                	mov    %ecx,%edx
401162:	2b 10                	sub    (%rax),%edx
401164:	89 10                	mov    %edx,(%rax)	&#x2F;&#x2F;arr[i] &#x3D; 7 - arr[i]
401166:	48 83 c0 04          	add    $0x4,%rax
40116a:	48 39 f0             	cmp    %rsi,%rax
40116d:	75 f1                	jne    401160 &lt;phase_6+0x6c&gt;
------
for (int i &#x3D; 0; i &lt; 6; ++i)
	arr[i] &#x3D; 7 - arr[i];
------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>继续往下看</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">40116f:	be 00 00 00 00       	mov    $0x0,%esi
401174:	eb 21                	jmp    401197 &lt;phase_6+0xa3&gt;

401176:	48 8b 52 08          	mov    0x8(%rdx),%rdx
40117a:	83 c0 01             	add    $0x1,%eax
40117d:	39 c8                	cmp    %ecx,%eax
40117f:	75 f5                	jne    401176 &lt;phase_6+0x82&gt;
401181:	eb 05                	jmp    401188 &lt;phase_6+0x94&gt;

401183:	ba d0 32 60 00       	mov    $0x6032d0,%edx
401188:	48 89 54 74 20       	mov    %rdx,0x20(%rsp,%rsi,2)
40118d:	48 83 c6 04          	add    $0x4,%rsi
401191:	48 83 fe 18          	cmp    $0x18,%rsi
401195:	74 14                	je     4011ab &lt;phase_6+0xb7&gt;

401197:	8b 0c 34             	mov    (%rsp,%rsi,1),%ecx
40119a:	83 f9 01             	cmp    $0x1,%ecx
40119d:	7e e4                	jle    401183 &lt;phase_6+0x8f&gt;
40119f:	b8 01 00 00 00       	mov    $0x1,%eax
4011a4:	ba d0 32 60 00       	mov    $0x6032d0,%edx
4011a9:	eb cb                	jmp    401176 &lt;phase_6+0x82&gt;

4011ab:	48 8b 5c 24 20       	mov    0x20(%rsp),%rbx
------ 新建数组，narr，首地址为0x20(%rsp)
for (int i &#x3D; 0; i &lt; 6; ++i) &#123;
	int count &#x3D; arr[i];
	int address &#x3D; 0x6032d0;
	for (int j &#x3D; 1; j &lt; count; ++j)
		address &#x3D; *(address) + 0x8;
	*(%rsp + 2*%rsi + 0x20) &#x3D; address;
	
&#125;
------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>从而新数组<code>narr</code>的首地址为%rsp+0x20，结束地址(narr.end())为%rsp+0x50（一个数据为一个地址，占据8个字节），输出一下0x6032d0处存储的地址值</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210331111938939.png" alt="image-20210331111938939"></p>
</li>
</ul>
<p>继续往下分析汇编代码(终于快结束了orz…)</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">4011ab:	48 8b 5c 24 20       	mov    0x20(%rsp),%rbx
4011b0:	48 8d 44 24 28       	lea    0x28(%rsp),%rax
4011b5:	48 8d 74 24 50       	lea    0x50(%rsp),%rsi
4011ba:	48 89 d9             	mov    %rbx,%rcx

4011bd:	48 8b 10             	mov    (%rax),%rdx
4011c0:	48 89 51 08          	mov    %rdx,0x8(%rcx)
4011c4:	48 83 c0 08          	add    $0x8,%rax
4011c8:	48 39 f0             	cmp    %rsi,%rax
4011cb:	74 05                	je     4011d2 &lt;phase_6+0xde&gt;
4011cd:	48 89 d1             	mov    %rdx,%rcx
4011d0:	eb eb                	jmp    4011bd &lt;phase_6+0xc9&gt;

4011d2:	48 c7 42 08 00 00 00 	movq   $0x0,0x8(%rdx)
------
for (int i &#x3D; 1; i &lt; 6; ++i) &#123;
	*(narr[i - 1] + 0x8) &#x3D; narr[i];
&#125;
------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>最后的代码：</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">4011d2:	48 c7 42 08 00 00 00 	movq   $0x0,0x8(%rdx)
4011d9:	00 
4011da:	bd 05 00 00 00       	mov    $0x5,%ebp

4011df:	48 8b 43 08          	mov    0x8(%rbx),%rax
4011e3:	8b 00                	mov    (%rax),%eax
4011e5:	39 03                	cmp    %eax,(%rbx)
4011e7:	7d 05                	jge    4011ee &lt;phase_6+0xfa&gt;
4011e9:	e8 4c 02 00 00       	callq  40143a &lt;explode_bomb&gt;

4011ee:	48 8b 5b 08          	mov    0x8(%rbx),%rbx
4011f2:	83 ed 01             	sub    $0x1,%ebp
4011f5:	75 e8                	jne    4011df &lt;phase_6+0xeb&gt;
------
for (int i &#x3D; 1; i &lt; 6; ++i) &#123;
	if (*narr[i - 1] &lt; *narr[i])
		bomb();
&#125;
------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>继续回顾一下0x6032d0处的取值</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210331114704652.png" alt="image-20210331114704652"></p>
<p>总结前面的汇编代码我们可以得出：</p>
<ul>
<li>narr[1…6]存储{0x6032d0, 0x6032e0, 0x6032f0, 0x0x603300, 0x603310, 0x603320}这几个地址</li>
<li>这几个地址处存储的整数值，满足逆序排序的关系，即*(narr[i - 1]) &gt;= *(narr[i])</li>
<li>narr[i]由7-arr[i]映射而来</li>
</ul>
<p>满足*(narr[i - 1] &gt;= *(narr[i]))的数组顺序为</p>
<pre class="line-numbers language-none"><code class="language-none">3			4			5			6			1			2
0x6032f0	0x603300	0x603310	0x603320	0x6032d0	0x6032e0
924			691			477			443			332			168<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>由于第一行的对应下标为7-arr[i]得来的（为什么不是0开头呢？因为变换前后都要满足0&lt;=arr[i]&lt;=6，所以准确来说arr[i]&gt;=1），因此arr[i]，也就是phase6的<strong>key</strong>为</p>
<p><strong>4 3 2 1 6 5</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora_image_2021_03_26/image-20210331122034081.png" alt="image-20210331122034081"></p>
<p>至此，bomblab就全部完成了。当然还有一个彩蛋关，如果各位时间充裕的话可以尝试一下，这里就挖个坑（可能不会填）。这个lab确实花费了我蛮长的准备时间，以及中间做的时候翻了好多别人的博客（有能力的话建议独立解决），从gdb调试器的用法到简单汇编代码的拆分和阅读，确实是一个不错的练习机会。</p>
<h3 id="参考">参考</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/57977157">https://zhuanlan.zhihu.com/p/57977157</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/104130161">https://zhuanlan.zhihu.com/p/104130161</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/luy-0/CS-APP-LABs/blob/master/Lab-Answer_HB/Lab2-BombLab/L2-Bomb-Note.md">https://github.com/luy-0/CS-APP-LABs/blob/master/Lab-Answer_HB/Lab2-BombLab/L2-Bomb-Note.md</a></p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://nexisato.github.io">Nexisato</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://nexisato.github.io/2021/03/26/csapp-bomblab/">https://nexisato.github.io/2021/03/26/csapp-bomblab/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://nexisato.github.io" target="_blank">CaddiesNew's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/TopImages/CSAPP.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/04/06/csapp-attacklab/" title="CSAPP Lab (03)-Attack Lab"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/TopImages/CSAPP.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CSAPP Lab (03)-Attack Lab</div></div></a></div><div class="next-post pull-right"><a href="/2021/03/11/interview-20210311/" title="2021暑实投递记录(持久更新)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/TopImages/InterView.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">2021暑实投递记录(持久更新)</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/typora-user-images/1.JPG" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Nexisato</div><div class="author-info__description">我们的故事进行到哪了?</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/nexisato" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:nexisato0810@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://leetcode-cn.com/u/nexisato/" target="_blank" title="LeetCode Pages"><i class="fas fa-code"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text">任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E5%82%A8%E5%A4%87"><span class="toc-number">2.</span> <span class="toc-text">知识储备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WriteUp"><span class="toc-number">3.</span> <span class="toc-text">WriteUp</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#phase1"><span class="toc-number">3.1.</span> <span class="toc-text">phase1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#phase2"><span class="toc-number">3.2.</span> <span class="toc-text">phase2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#phase3"><span class="toc-number">3.3.</span> <span class="toc-text">phase3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#phase4"><span class="toc-number">3.4.</span> <span class="toc-text">phase4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#phase5"><span class="toc-number">3.5.</span> <span class="toc-text">phase5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#phase6"><span class="toc-number">3.6.</span> <span class="toc-text">phase6</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://msigl62m-1258130641.cos.ap-shanghai.myqcloud.com/TopImages/CSAPP.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Nexisato</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '0YTDhGSKuv7oYt5awmdHaH2w-gzGzoHsz',
      appKey: 'aH2eqIdUznwmTHTuJjGEVqrz',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>